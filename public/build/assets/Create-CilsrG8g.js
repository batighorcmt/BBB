import{h as E,c as i,d as f,u as r,j as T,e as h,b as t,m as $,f as V,w as l,o as p,F as m,q as v,t as c,s as F,p as u,k as _,l as Q,B as D,x as U,a as N}from"./app-DnZcKKuq.js";import{_ as W}from"./AuthenticatedLayout-B60uBWx6.js";import{S as q}from"./sweetalert2.esm.all-BoFtKDfH.js";const L={class:"py-12"},B={class:"w-full mx-auto sm:px-6 lg:px-8"},A={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},M={class:"p-6 text-gray-900 dark:text-gray-100"},z={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},O=["value"],R={key:0,class:"text-center py-4"},G={key:1,class:"overflow-x-auto mb-8"},H={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 border"},J={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200"},K={class:"px-2 py-2 text-sm"},X={class:"px-2 py-2"},Y=["onUpdate:modelValue","onInput"],Z={class:"px-2 py-2"},tt=["onUpdate:modelValue","onInput"],et={class:"px-2 py-2"},ot=["onUpdate:modelValue","onInput"],st={class:"px-2 py-2"},at=["onUpdate:modelValue","onInput"],dt={class:"px-2 py-2"},nt=["onUpdate:modelValue","onInput"],rt={class:"px-2 py-2"},lt=["onUpdate:modelValue","onInput"],it={class:"px-2 py-2"},pt=["onUpdate:modelValue","onInput"],ut={class:"px-2 py-2 font-bold bg-gray-50 dark:bg-gray-900 text-right text-sm"},ct={class:"px-2 py-2 font-bold bg-gray-50 dark:bg-gray-900 text-right text-sm"},gt={key:2,class:"mb-8"},xt={class:"overflow-x-auto"},mt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 border border-red-200"},_t={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200"},yt={class:"px-4 py-2 text-sm"},bt={class:"px-4 py-2"},ft=["onUpdate:modelValue"],ht={class:"px-4 py-2"},vt=["onUpdate:modelValue"],wt={key:3,class:"flex justify-end"},kt={class:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full md:w-1/3"},Vt={class:"flex justify-between items-center mb-2"},Ft={class:"font-bold text-lg"},Ut={class:"flex justify-between items-center mb-2 border-b pb-2"},qt={class:"font-bold text-green-600"},It={class:"flex justify-between items-center pt-2"},Pt={class:"text-xl font-bold text-indigo-600"},St={class:"mt-8 flex justify-end space-x-3"},Ct=["disabled"],$t={__name:"Create",props:{quotations:Array},setup(I){const a=E({quotation_id:"",production_date:new Date().toISOString().slice(0,10),status:"pending",items:[],total_cost:0,note:""}),w=U(null),y=U(!1),P=async()=>{if(a.quotation_id){y.value=!0;try{const d=await D.get(route("api.quotations.show",a.quotation_id));w.value=d.data,a.items=d.data.items.map(e=>{var o;return{quotation_item_id:e.id,product_name:((o=e.item)==null?void 0:o.name)||e.description||"Unknown Product",size:e.size||"",quantity:parseFloat(e.quantity),envelope_weight:0,envelope_price:0,loop_weight:0,loop_price:0,print_cost:0,sewing_cost:0,price_per_piece:0,total_price:0,wastage_kg:0,wastage_piece:0}}),k()}catch(d){console.error("Error fetching quotation:",d),q.fire("Error","Failed to load quotation details.","error")}finally{y.value=!1}}},g=d=>{const e=a.items[d],o=parseFloat(e.quantity)||0;if(o<=0){e.price_per_piece=0,e.total_price=0;return}const n=(parseFloat(e.envelope_weight)||0)*(parseFloat(e.envelope_price)||0),s=(parseFloat(e.loop_weight)||0)*(parseFloat(e.loop_price)||0),C=(parseFloat(e.print_cost)||0)*o,j=(parseFloat(e.sewing_cost)||0)*o,x=n+s+C+j;e.price_per_piece=isFinite(x/o)?(x/o).toFixed(2):0,e.total_price=isFinite(x)?x.toFixed(2):0,k()},k=()=>{let d=0;a.items.forEach(e=>{d+=parseFloat(e.total_price)||0}),a.total_cost=d.toFixed(2)},b=N(()=>{var o;const d=parseFloat(a.total_cost)||0,e=parseFloat((o=w.value)==null?void 0:o.advance_amount)||0;return{total:d.toFixed(2),advance:e.toFixed(2),final:(d-e).toFixed(2)}}),S=()=>{a.post(route("production.store"),{onError:d=>{console.error(d),q.fire({icon:"error",title:"Validation Error",text:"Please check the form for errors.",footer:Object.values(d).join("<br>")})},onSuccess:()=>{}})};return(d,e)=>(p(),i(m,null,[f(r(T),{title:"Start Production"}),f(W,null,{header:h(()=>[...e[3]||(e[3]=[t("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"Start New Production",-1)])]),default:h(()=>[t("div",L,[t("div",B,[t("div",A,[t("div",M,[t("form",{onSubmit:$(S,["prevent"])},[t("div",z,[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[V("Select Quotation "),t("span",{class:"text-red-500"},"*")],-1)),l(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r(a).quotation_id=o),onChange:P,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},[e[4]||(e[4]=t("option",{value:"",disabled:""},"Select a Pending Quotation",-1)),(p(!0),i(m,null,v(I.quotations,o=>{var n;return p(),i("option",{key:o.id,value:o.id},c(o.quotation_no)+" - "+c((n=o.customer)==null?void 0:n.name),9,O)}),128))],544),[[F,r(a).quotation_id]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Status",-1)),l(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r(a).status=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...e[6]||(e[6]=[t("option",{value:"pending"},"Pending",-1),t("option",{value:"working"},"Working",-1),t("option",{value:"completed"},"Completed",-1),t("option",{value:"cancelled"},"Cancelled",-1)])],512),[[F,r(a).status]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Note",-1)),l(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>r(a).note=o),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[u,r(a).note]])])]),y.value?(p(),i("div",R,"Loading Quotation Details...")):_("",!0),r(a).items.length>0?(p(),i("div",G,[e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Production Items",-1)),t("table",H,[e[9]||(e[9]=t("thead",{class:"bg-blue-600 text-white"},[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Product"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-16"},"Qty"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Env Wt (kg)"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Env Price"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Loop Wt (kg)"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Loop Price"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Print (pc)"),t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Sewing (pc)"),t("th",{class:"px-2 py-2 text-left text-xs font-medium bg-gray-700"},"Cost/Pc"),t("th",{class:"px-2 py-2 text-left text-xs font-medium bg-gray-700"},"Total")])],-1)),t("tbody",J,[(p(!0),i(m,null,v(r(a).items,(o,n)=>(p(),i("tr",{key:n},[t("td",K,c(o.product_name),1),t("td",X,[l(t("input",{"onUpdate:modelValue":s=>o.quantity=s,type:"number",step:"1",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n),required:""},null,40,Y),[[u,o.quantity]])]),t("td",Z,[l(t("input",{"onUpdate:modelValue":s=>o.envelope_weight=s,type:"number",step:"0.001",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,tt),[[u,o.envelope_weight]])]),t("td",et,[l(t("input",{"onUpdate:modelValue":s=>o.envelope_price=s,type:"number",step:"0.01",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,ot),[[u,o.envelope_price]])]),t("td",st,[l(t("input",{"onUpdate:modelValue":s=>o.loop_weight=s,type:"number",step:"0.001",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,at),[[u,o.loop_weight]])]),t("td",dt,[l(t("input",{"onUpdate:modelValue":s=>o.loop_price=s,type:"number",step:"0.01",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,nt),[[u,o.loop_price]])]),t("td",rt,[l(t("input",{"onUpdate:modelValue":s=>o.print_cost=s,type:"number",step:"0.01",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,lt),[[u,o.print_cost]])]),t("td",it,[l(t("input",{"onUpdate:modelValue":s=>o.sewing_cost=s,type:"number",step:"0.01",class:"w-20 rounded-md border-gray-300 text-xs p-1 text-right",onInput:s=>g(n)},null,40,pt),[[u,o.sewing_cost]])]),t("td",ut,c(o.price_per_piece),1),t("td",ct,c(o.total_price),1)]))),128))])])])):_("",!0),r(a).items.length>0?(p(),i("div",gt,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-red-600 dark:text-red-400 mb-2"},"Wastage Details",-1)),t("div",xt,[t("table",mt,[e[11]||(e[11]=t("thead",{class:"bg-red-50 dark:bg-red-900 text-red-800 dark:text-red-100"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium"},"Product"),t("th",{class:"px-4 py-2 text-left text-xs font-medium"},"Wastage (kg)"),t("th",{class:"px-4 py-2 text-left text-xs font-medium"},"Wastage (Piece)")])],-1)),t("tbody",_t,[(p(!0),i(m,null,v(r(a).items,(o,n)=>(p(),i("tr",{key:n},[t("td",yt,c(o.product_name),1),t("td",bt,[l(t("input",{"onUpdate:modelValue":s=>o.wastage_kg=s,type:"number",step:"0.001",class:"w-32 rounded-md border-red-300 text-sm p-1"},null,8,ft),[[u,o.wastage_kg]])]),t("td",ht,[l(t("input",{"onUpdate:modelValue":s=>o.wastage_piece=s,type:"number",step:"1",class:"w-32 rounded-md border-red-300 text-sm p-1"},null,8,vt),[[u,o.wastage_piece]])])]))),128))])])])])):_("",!0),r(a).items.length>0?(p(),i("div",wt,[t("div",kt,[t("div",Vt,[e[13]||(e[13]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Total Production Cost:",-1)),t("span",Ft,c(b.value.total),1)]),t("div",Ut,[e[14]||(e[14]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Advance Paid (from Quotation):",-1)),t("span",qt,"- "+c(b.value.advance),1)]),t("div",It,[e[15]||(e[15]=t("span",{class:"text-xl font-bold text-gray-800 dark:text-white"},"Final / Due Amount:",-1)),t("span",Pt,c(b.value.final),1)])])])):_("",!0),t("div",St,[f(r(Q),{href:d.route("production.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:h(()=>[...e[16]||(e[16]=[V("Cancel",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded shadow-lg",disabled:r(a).processing}," Save Production ",8,Ct)])],32)])])])])]),_:1})],64))}};export{$t as default};
