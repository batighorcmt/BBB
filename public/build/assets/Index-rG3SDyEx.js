import{u as A,o as j,a as D,c as i,b as f,d as o,h as L,w as y,e,f as r,t as d,g as B,v as M,i as b,n as k,j as S,F as z,r as u}from"./app-CV5OePXJ.js";import{_ as V}from"./AuthenticatedLayout-73GYwnhN.js";const H={class:"py-12"},N={class:"max-w-3xl mx-auto sm:px-6 lg:px-8"},P={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg p-6"},$={key:0,class:"text-red-500 mb-4"},F={key:1,class:"text-center py-10"},O={class:"text-gray-500 mt-2"},T={key:2},U={class:"mb-6"},E={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2"},I={class:"text-sm text-gray-500"},q={class:"relative bg-black rounded-lg overflow-hidden aspect-video mb-6"},G=["src"],R={key:1,class:"absolute inset-0 flex items-center justify-center bg-red-900/50 text-white p-4 text-center"},W={class:"flex justify-between items-center mb-6"},J={class:"text-sm dark:text-gray-300"},K={class:"flex items-center space-x-2"},Q=["disabled"],ee={__name:"Index",props:{todayAttendance:Object,employee:Object},setup(s){const v=u(null),c=u(null),m=u(null),n=u(null),g=u({lat:null,lng:null}),x=u(""),h=u(""),t=A({image:"",latitude:null,longitude:null,location_address:""}),w=async()=>{try{m.value=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}}),v.value&&(v.value.srcObject=m.value)}catch{h.value="Camera access denied or not available."}},p=()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(async l=>{g.value={lat:l.coords.latitude,lng:l.coords.longitude},t.latitude=g.value.lat,t.longitude=g.value.lng,x.value=`Lat: ${g.value.lat}, Lng: ${g.value.lng}`,t.location_address=x.value},l=>{h.value="Location access denied. Please enable location to mark attendance."}):h.value="Geolocation is not supported by your browser."},_=()=>{const l=c.value.getContext("2d");c.value.width=v.value.videoWidth,c.value.height=v.value.videoHeight,l.drawImage(v.value,0,0,c.value.width,c.value.height),n.value=c.value.toDataURL("image/jpeg"),t.image=n.value},C=()=>{if(!t.image)return alert("Please capture a photo first.");if(!t.latitude)return alert("Please wait for location to be acquired.");t.post(route("attendance.store"),{preserveScroll:!0,onSuccess:()=>{n.value=null,t.image=""}})};return j(()=>{p(),w()}),D(()=>{m.value&&m.value.getTracks().forEach(l=>l.stop())}),(l,a)=>(r(),i(z,null,[f(o(L),{title:"Attendance"}),f(V,null,{header:y(()=>[...a[1]||(a[1]=[e("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"}," Daily Attendance ",-1)])]),default:y(()=>[e("div",H,[e("div",N,[e("div",P,[s.employee?s.todayAttendance&&s.todayAttendance.check_out?(r(),i("div",F,[a[2]||(a[2]=e("div",{class:"text-green-500 mb-4"},[e("svg",{class:"w-20 h-20 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),a[3]||(a[3]=e("h3",{class:"text-2xl font-bold dark:text-white"},"আজকের হাজিরা সম্পন্ন হয়েছে!",-1)),e("p",O,"Check-in: "+d(s.todayAttendance.check_in)+" | Check-out: "+d(s.todayAttendance.check_out),1)])):(r(),i("div",T,[e("div",U,[e("h3",E,d(s.todayAttendance?"আজকের তথ্য: Check-out করুন":"আজকের তথ্য: Check-in করুন"),1),e("p",I,d(new Date().toLocaleDateString("bn-BD"))+" | "+d(new Date().toLocaleTimeString()),1)]),e("div",q,[B(e("video",{ref_key:"video",ref:v,autoplay:"",playsinline:"",class:"w-full h-full object-cover"},null,512),[[M,!n.value]]),n.value?(r(),i("img",{key:0,src:n.value,class:"w-full h-full object-cover"},null,8,G)):b("",!0),h.value?(r(),i("div",R,d(h.value),1)):b("",!0)]),e("canvas",{ref_key:"canvas",ref:c,class:"hidden"},null,512),e("div",W,[e("div",J,[e("div",K,[e("span",{class:k(o(t).latitude?"text-green-500":"text-gray-400")},[...a[4]||(a[4]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z","clip-rule":"evenodd"})],-1)])],2),e("span",null,d(o(t).latitude?"লোকেশন পাওয়া গেছে":"লোকেশন খোঁজা হচ্ছে..."),1)])]),n.value?(r(),i("button",{key:1,onClick:a[0]||(a[0]=X=>{n.value=null,o(t).image=""}),class:"text-red-500 font-medium"}," আবার তুলুন ")):(r(),i("button",{key:0,onClick:_,class:"bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition flex items-center"},[...a[5]||(a[5]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 011.664.89l.812 1.22A2 2 0 0010.07 10H13.93a2 2 0 001.664-1.89l.812-1.22A2 2 0 0118.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"})],-1),S(" ছবি তুলুন ",-1)])]))]),e("button",{onClick:C,disabled:o(t).processing||!o(t).image||!o(t).latitude,class:k(["w-full py-4 rounded-xl text-white font-bold text-lg transition shadow-lg",[s.todayAttendance?"bg-orange-600 hover:bg-orange-700":"bg-green-600 hover:bg-green-700",o(t).processing||!o(t).image||!o(t).latitude?"opacity-50 cursor-not-allowed":""]])},d(o(t).processing?"প্রসেসিং হচ্ছে...":s.todayAttendance?"Check-out করুন":"Check-in করুন"),11,Q)])):(r(),i("div",$," আপনি কোনো এমপ্লয়ী রোলে যুক্ত নেই। দয়া করে এডমিনের সাথে যোগাযোগ করুন। "))])])])]),_:1})],64))}};export{ee as default};
