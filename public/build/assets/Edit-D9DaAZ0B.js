import{u as A,B as S,c as m,b as w,d as n,h as L,w as v,e as t,z as $,j as C,g as u,f as y,F as k,l as E,t as x,A as T,i as F,k as c,s as D,D as I,r as N}from"./app-CV5OePXJ.js";import{_ as q}from"./AuthenticatedLayout-73GYwnhN.js";import{S as V}from"./sweetalert2.esm.all-BoFtKDfH.js";const B={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},M={class:"py-12"},O={class:"w-full mx-auto sm:px-6 lg:px-8"},R={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},W={class:"p-6 text-gray-900 dark:text-gray-100"},G={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},Q={class:"md:col-span-2"},H=["value"],J=["value"],K={key:0,class:"text-center py-8"},X={key:1,class:"overflow-x-auto mb-8"},Y={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 border"},Z={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200"},tt={class:"px-2 py-2"},et=["onUpdate:modelValue"],ot={class:"px-2 py-2 text-xs"},st={class:"px-2 py-2 text-xs text-gray-500"},at={class:"px-2 py-2 text-xs text-gray-500"},dt={class:"px-1 py-1"},nt=["onUpdate:modelValue","onInput"],lt={class:"px-1 py-1"},rt=["onUpdate:modelValue","onInput"],it={class:"px-1 py-1"},pt=["onUpdate:modelValue","onInput"],ut={class:"px-1 py-1"},ct=["onUpdate:modelValue","onInput"],xt={class:"px-1 py-1"},_t=["onUpdate:modelValue","onInput"],gt={class:"px-1 py-1"},mt=["onUpdate:modelValue","onInput"],yt={class:"px-1 py-1"},bt=["onUpdate:modelValue","onInput"],ft={class:"px-2 py-2 text-right text-xs font-bold bg-gray-50"},ht={class:"px-2 py-2 text-right text-xs font-bold bg-gray-50"},wt={key:2,class:"flex flex-col md:flex-row justify-end space-y-4 md:space-y-0 md:space-x-8"},vt={class:"w-full md:w-1/3 space-y-3"},kt={class:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full md:w-1/2 lg:w-1/3"},Ft={class:"space-y-2"},Vt={class:"flex justify-between items-center"},Ut={class:"font-bold"},jt={class:"flex justify-between items-center"},St={class:"flex justify-between items-center"},Ct={class:"flex justify-between items-center border-b pb-2"},Et={class:"flex justify-between items-center pt-2"},Tt={class:"text-lg font-bold"},Pt={class:"flex justify-between items-center text-green-700"},zt={class:"flex justify-between items-center font-semibold border-t pt-2 mt-2"},At={class:"flex justify-between items-center bg-blue-50 p-2 rounded"},Lt={class:"flex justify-between items-center pt-2"},$t={class:"text-xl font-bold text-red-600"},Dt={class:"mt-8 flex justify-end space-x-3"},It=["disabled"],Mt={__name:"Edit",props:{sale:Object,productions:Array},setup(b){var j;const i=b,o=A({production_id:i.sale.production_id,customer_id:i.sale.customer_id,customer_name:(j=i.sale.customer)==null?void 0:j.name,type:i.sale.type,sale_date:new Date(i.sale.created_at).toISOString().slice(0,10),items:i.sale.items.map(d=>({id:d.id,production_item_id:d.production_item_id,item_name:d.item_name,size:d.size,gsm:d.gsm,color:d.color,envelope_weight:d.envelope_weight,envelope_price:d.envelope_price,loop_weight:d.loop_weight,loop_price:d.loop_price,print_cost:d.print_cost,sewing_cost:d.sewing_cost,quantity:d.quantity,price_per_piece:d.price_per_piece,total_price:d.total_price})),subtotal:i.sale.subtotal,discount:i.sale.discount,tax:i.sale.tax,other_costs:i.sale.other_costs,grand_total:i.sale.grand_total,advance_adjusted:i.sale.advance_adjusted,paid_amount:i.sale.paid_amount,due_amount:i.sale.due_amount,note:i.sale.note}),f=N(!1),U=async()=>{var d,e,s;if(o.production_id){o.production_id,i.sale.production_id,f.value=!0;try{const a=(await I.get(route("api.productions.show",o.production_id))).data;o.customer_id=(d=a.quotation)==null?void 0:d.customer_id,o.customer_name=(s=(e=a.quotation)==null?void 0:e.customer)==null?void 0:s.name,o.advance_adjusted=parseFloat(a.advance_amount)||0,o.items=a.items.map(p=>{const l=p.quotation_item,_=l==null?void 0:l.item,z=o.type==="local"&&parseFloat(l==null?void 0:l.unit_price)||0;return{production_item_id:p.id,item_name:p.product_name,size:(l==null?void 0:l.size)||p.size||"",gsm:(l==null?void 0:l.gsm)||(_==null?void 0:_.gsm)||"",color:(l==null?void 0:l.color)||(_==null?void 0:_.fabric_color)||"",envelope_weight:parseFloat(p.envelope_weight)||0,envelope_price:parseFloat(p.envelope_price)||0,loop_weight:parseFloat(p.loop_weight)||0,loop_price:parseFloat(p.loop_price)||0,print_cost:parseFloat(p.print_cost)||0,sewing_cost:parseFloat(p.sewing_cost)||0,quantity:parseFloat(p.quantity)||0,price_per_piece:z,total_price:0}}),o.items.forEach((p,l)=>g(l))}catch(r){console.error("Error fetching production:",r),V.fire("Error","Failed to load production details.","error")}finally{f.value=!1}}},g=d=>{const e=o.items[d],s=parseFloat(e.quantity)||0;if(s<=0){e.price_per_piece=0,e.total_price=0,h();return}if(o.type==="local")e.total_price=(parseFloat(e.price_per_piece)*s).toFixed(2);else{const r=(parseFloat(e.envelope_weight)||0)*(parseFloat(e.envelope_price)||0),a=(parseFloat(e.loop_weight)||0)*(parseFloat(e.loop_price)||0),p=(parseFloat(e.print_cost)||0)*s,l=(parseFloat(e.sewing_cost)||0)*s,_=r+a+p+l;e.price_per_piece=(_/s).toFixed(2),e.total_price=_.toFixed(2)}h()},h=()=>{let d=0;o.items.forEach(_=>{d+=parseFloat(_.total_price)||0}),o.subtotal=d.toFixed(2);const e=parseFloat(o.discount)||0,s=parseFloat(o.tax)||0,r=parseFloat(o.other_costs)||0,a=d-e+s+r;o.grand_total=a.toFixed(2);const p=parseFloat(o.advance_adjusted)||0,l=parseFloat(o.paid_amount)||0;o.due_amount=(a-p-l).toFixed(2)};S(()=>[o.discount,o.tax,o.other_costs,o.advance_adjusted,o.paid_amount],()=>{h()}),S(()=>o.type,()=>{o.production_id&&U()});const P=()=>{o.put(route("sales.update",i.sale.id),{onSuccess:()=>V.fire("Updated!","Sale has been updated successfully.","success"),onError:d=>{console.error(d),V.fire({icon:"error",title:"Validation Error",text:"Please check the form for errors.",footer:Object.values(d).join("<br>")})}})};return(d,e)=>(y(),m(k,null,[w(n(L),{title:"Edit Sale"}),w(q,null,{header:v(()=>[t("h2",B,"Edit Sale Invoice #"+x(b.sale.sale_no),1)]),default:v(()=>[t("div",M,[t("div",O,[t("div",R,[t("div",W,[t("form",{onSubmit:$(P,["prevent"])},[t("div",G,[t("div",Q,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[C("Select Production "),t("span",{class:"text-red-500"},"*")],-1)),u(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>n(o).production_id=s),onChange:U,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},[(y(!0),m(k,null,E([b.sale.production,...b.productions],s=>{var r,a;return y(),m("option",{key:s.id,value:s.id},x(s.production_no)+" - "+x((a=(r=s.quotation)==null?void 0:r.customer)==null?void 0:a.name),9,H)}),128))],544),[[T,n(o).production_id]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Sale Type",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>n(o).type=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...e[9]||(e[9]=[t("option",{value:"wholesale"},"Wholesale",-1),t("option",{value:"local"},"Local Sales",-1)])],512),[[T,n(o).type]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Customer",-1)),t("input",{type:"text",value:n(o).customer_name,readonly:"",class:"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 dark:bg-gray-600 dark:text-gray-300 cursor-not-allowed"},null,8,J)])]),f.value?(y(),m("div",K,[...e[12]||(e[12]=[t("p",{class:"text-lg animate-pulse"},"Loading Production Details...",-1)])])):F("",!0),n(o).items.length>0?(y(),m("div",X,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Sale Items",-1)),t("table",Y,[e[13]||(e[13]=t("thead",{class:"bg-indigo-600 text-white"},[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Item Name"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-16"},"Size"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-16"},"GSM"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-20"},"Color"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Env Wt"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Env Price"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Loop Wt"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Loop Price"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Print"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Sewing"),t("th",{class:"px-2 py-2 text-right text-xs font-medium w-16"},"Qty"),t("th",{class:"px-2 py-2 text-right text-xs font-medium bg-gray-700"},"Rate"),t("th",{class:"px-2 py-2 text-right text-xs font-medium bg-gray-700"},"Total")])],-1)),t("tbody",Z,[(y(!0),m(k,null,E(n(o).items,(s,r)=>(y(),m("tr",{key:r},[t("td",tt,[u(t("input",{"onUpdate:modelValue":a=>s.item_name=a,type:"text",class:"w-24 rounded-md border-gray-300 text-xs p-1",readonly:""},null,8,et),[[c,s.item_name]])]),t("td",ot,x(s.size),1),t("td",st,x(s.gsm),1),t("td",at,x(s.color),1),t("td",dt,[u(t("input",{"onUpdate:modelValue":a=>s.envelope_weight=a,type:"number",step:"0.001",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,nt),[[c,s.envelope_weight]])]),t("td",lt,[u(t("input",{"onUpdate:modelValue":a=>s.envelope_price=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,rt),[[c,s.envelope_price]])]),t("td",it,[u(t("input",{"onUpdate:modelValue":a=>s.loop_weight=a,type:"number",step:"0.001",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,pt),[[c,s.loop_weight]])]),t("td",ut,[u(t("input",{"onUpdate:modelValue":a=>s.loop_price=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,ct),[[c,s.loop_price]])]),t("td",xt,[u(t("input",{"onUpdate:modelValue":a=>s.print_cost=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,_t),[[c,s.print_cost]])]),t("td",gt,[u(t("input",{"onUpdate:modelValue":a=>s.sewing_cost=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,mt),[[c,s.sewing_cost]])]),t("td",yt,[u(t("input",{"onUpdate:modelValue":a=>s.quantity=a,type:"number",step:"1",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right font-bold",onInput:a=>g(r)},null,40,bt),[[c,s.quantity]])]),t("td",ft,x(s.price_per_piece),1),t("td",ht,x(s.total_price),1)]))),128))])])])):F("",!0),n(o).items.length>0?(y(),m("div",wt,[t("div",vt,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium"},"Notes",-1)),u(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>n(o).note=s),class:"w-full rounded-md border-gray-300 shadow-sm",rows:"3"},null,512),[[c,n(o).note]])]),t("div",kt,[t("div",Ft,[t("div",Vt,[e[16]||(e[16]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Subtotal",-1)),t("span",Ut,x(n(o).subtotal),1)]),t("div",jt,[e[17]||(e[17]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Less: Discount",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n(o).discount=s),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[c,n(o).discount]])]),t("div",St,[e[18]||(e[18]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Add: Tax/VAT",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n(o).tax=s),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[c,n(o).tax]])]),t("div",Ct,[e[19]||(e[19]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Other Costs",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n(o).other_costs=s),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[c,n(o).other_costs]])]),t("div",Et,[e[20]||(e[20]=t("span",{class:"text-lg font-bold"},"Grand Total",-1)),t("span",Tt,x(n(o).grand_total),1)]),t("div",Pt,[e[21]||(e[21]=t("span",null,"Less: Advance (Adjusted)",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>n(o).advance_adjusted=s),type:"number",class:"w-24 text-right rounded-md border-green-300 bg-green-50 p-1 font-bold"},null,512),[[c,n(o).advance_adjusted]])]),t("div",zt,[e[22]||(e[22]=t("span",null,"Receivable Amount",-1)),t("span",null,x((parseFloat(n(o).grand_total)-parseFloat(n(o).advance_adjusted||0)).toFixed(2)),1)]),t("div",At,[e[23]||(e[23]=t("span",{class:"font-bold text-blue-800"},"Paid Now",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>n(o).paid_amount=s),type:"number",class:"w-32 text-right rounded-md border-blue-300 p-1 font-bold text-lg"},null,512),[[c,n(o).paid_amount]])]),t("div",Lt,[e[24]||(e[24]=t("span",{class:"text-xl font-bold text-red-600"},"Due Amount",-1)),t("span",$t,x(n(o).due_amount),1)])])])])):F("",!0),t("div",Dt,[w(n(D),{href:d.route("sales.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:v(()=>[...e[25]||(e[25]=[C("Cancel",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded shadow-lg",disabled:n(o).processing}," Update Sale ",8,It)])],32)])])])])]),_:1})],64))}};export{Mt as default};
