import{h as A,y as V,c as l,d as c,u as n,j as E,e as f,b as t,m as T,w as m,o as u,F as h,q,t as p,s as U,k as b,p as _,l as $,f as C,n as M,E as N}from"./app-Cv-8DYvI.js";import{_ as P}from"./AuthenticatedLayout-DU_amY5i.js";import{_ as v}from"./InputLabel-DyJ4i9hs.js";import{_ as F}from"./TextInput-B2Dvcy-r.js";import{P as D}from"./PrimaryButton-D0ebMeJs.js";import{S as I}from"./sweetalert2.esm.all-BoFtKDfH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},R={class:"py-12"},G={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},L={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},O={class:"p-6 text-gray-900 dark:text-gray-100"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},H=["value"],J={key:1,class:"mt-2 font-medium"},K={key:2,class:"text-red-500 text-xs mt-1"},W={key:0,class:"text-red-500 text-xs mt-1"},X={key:0,class:"text-red-500 text-xs mt-1"},Z={class:"overflow-x-auto mb-6"},tt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},et={class:"px-2 py-2 min-w-[200px]"},ot=["onUpdate:modelValue","onChange"],st=["value"],at={class:"px-2 py-2"},nt=["onUpdate:modelValue"],dt={class:"px-2 py-2"},rt=["onUpdate:modelValue"],it={class:"px-2 py-2"},lt=["onUpdate:modelValue"],ut={class:"px-2 py-2"},mt=["onUpdate:modelValue"],pt={class:"px-2 py-2"},ct=["onUpdate:modelValue","onInput"],_t={class:"px-2 py-2"},xt=["onUpdate:modelValue","readonly","onInput"],gt={class:"px-2 py-2 text-right font-semibold"},yt={class:"px-2 py-2"},ft=["onClick"],ht={class:"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-4"},bt={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md"},vt={class:"flex justify-between mb-2"},wt={class:"flex justify-between mb-2 items-center"},qt={class:"flex justify-between mb-2 items-center"},kt={class:"flex justify-between mb-4 text-lg font-bold border-t pt-2"},Vt={class:"flex justify-between mb-2 items-center"},Ut={class:"mt-6 flex justify-end"},Tt={__name:"Edit",props:{quotation:Object,customers:Array,items:Array},setup(x){const i=x,k=N().props.auth.user.roles.some(a=>a.name==="customer"),o=A({customer_id:i.quotation.customer_id,quotation_date:i.quotation.quotation_date,valid_until:i.quotation.valid_until||"",items:i.quotation.items.map(a=>({item_id:a.item_id,description:a.description,size:a.size||"",color:a.color||"",gsm:a.gsm||"",print_color:a.print_color||"",print_side:a.print_side||"",quantity:parseFloat(a.quantity),unit_price:parseFloat(a.unit_price),total:parseFloat(a.total).toFixed(2)})),subtotal:i.quotation.subtotal,discount:i.quotation.discount,other_charges:i.quotation.other_charges||0,advance_amount:i.quotation.advance_amount,grand_total:i.quotation.total,notes:i.quotation.notes||"",terms_conditions:i.quotation.terms_conditions||""}),S=()=>{o.items.push({item_id:"",description:"",size:"",color:"",gsm:"",print_color:"",print_side:"",quantity:1,unit_price:0,total:0})},j=a=>{I.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, remove it!"}).then(e=>{e.isConfirmed&&(o.items.splice(a,1),g(),I.fire("Removed!","Item has been removed.","success"))})},z=a=>{const e=o.items[a].item_id,r=i.items.find(s=>s.id===e);r&&(o.items[a].description=r.name,o.items[a].unit_price=r.price,o.items[a].size=r.size||"",o.items[a].color=r.fabric_color||"",o.items[a].gsm=r.gsm||"",o.items[a].print_color=r.print_color_count||"",o.items[a].print_side=r.print_sides||"",w(a))},w=a=>{const e=o.items[a];e.total=(e.quantity*e.unit_price).toFixed(2),g()},g=()=>{let a=0;o.items.forEach(s=>{a+=parseFloat(s.total)||0}),o.subtotal=a.toFixed(2);const e=parseFloat(o.other_charges)||0,r=parseFloat(o.discount)||0;o.grand_total=(a+e-r).toFixed(2)};V(()=>o.items,a=>{a.forEach((e,r)=>{const s=(e.quantity*e.unit_price).toFixed(2);s!==e.total&&(e.total=s,g())}),g()},{deep:!0}),V(()=>[o.other_charges,o.discount],()=>{g()});const B=()=>{o.put(route("quotations.update",i.quotation.id))};return(a,e)=>(u(),l(h,null,[c(n(E),{title:"Edit Quotation"}),c(P,null,{header:f(()=>[t("h2",Q,"Edit Quotation #"+p(x.quotation.quotation_no),1)]),default:f(()=>{var r;return[t("div",R,[t("div",G,[t("div",L,[t("div",O,[t("form",{onSubmit:T(B,["prevent"])},[t("div",Y,[t("div",null,[c(v,{for:"customer_id",value:"Customer"}),n(k)?(u(),l("div",J,p((r=x.quotation.customer)==null?void 0:r.name),1)):m((u(),l("select",{key:0,id:"customer_id","onUpdate:modelValue":e[0]||(e[0]=s=>n(o).customer_id=s),class:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm",required:""},[e[7]||(e[7]=t("option",{value:"",disabled:""},"Select Customer",-1)),(u(!0),l(h,null,q(x.customers,s=>(u(),l("option",{key:s.id,value:s.id},p(s.name)+" ("+p(s.phone)+")",9,H))),128))],512)),[[U,n(o).customer_id]]),n(o).errors.customer_id?(u(),l("div",K,p(n(o).errors.customer_id),1)):b("",!0)]),t("div",null,[c(v,{for:"quotation_date",value:"Date"}),c(F,{id:"quotation_date",type:"date",class:"mt-1 block w-full",modelValue:n(o).quotation_date,"onUpdate:modelValue":e[1]||(e[1]=s=>n(o).quotation_date=s),required:""},null,8,["modelValue"]),n(o).errors.quotation_date?(u(),l("div",W,p(n(o).errors.quotation_date),1)):b("",!0)]),t("div",null,[c(v,{for:"valid_until",value:"Valid Until"}),c(F,{id:"valid_until",type:"date",class:"mt-1 block w-full",modelValue:n(o).valid_until,"onUpdate:modelValue":e[2]||(e[2]=s=>n(o).valid_until=s)},null,8,["modelValue"]),n(o).errors.valid_until?(u(),l("div",X,p(n(o).errors.valid_until),1)):b("",!0)])]),t("div",Z,[t("table",tt,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Size"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Color"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"GSM"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Print Color"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase text-right"},"Qty"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase text-right"},"Rate"),t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase text-right"},"Total"),t("th")])],-1)),t("tbody",null,[(u(!0),l(h,null,q(n(o).items,(s,y)=>(u(),l("tr",{key:y},[t("td",et,[m(t("select",{"onUpdate:modelValue":d=>s.item_id=d,onChange:d=>z(y),class:"w-full border-gray-300 dark:border-gray-700 rounded-md shadow-sm text-sm",required:""},[e[8]||(e[8]=t("option",{value:"",disabled:""},"Select Item",-1)),(u(!0),l(h,null,q(x.items,d=>(u(),l("option",{key:d.id,value:d.id},p(d.name)+" - "+p(d.code),9,st))),128))],40,ot),[[U,s.item_id]])]),t("td",at,[m(t("input",{"onUpdate:modelValue":d=>s.size=d,type:"text",class:"w-20 border-gray-300 rounded-md text-sm p-1"},null,8,nt),[[_,s.size]])]),t("td",dt,[m(t("input",{"onUpdate:modelValue":d=>s.color=d,type:"text",class:"w-20 border-gray-300 rounded-md text-sm p-1"},null,8,rt),[[_,s.color]])]),t("td",it,[m(t("input",{"onUpdate:modelValue":d=>s.gsm=d,type:"text",class:"w-16 border-gray-300 rounded-md text-sm p-1"},null,8,lt),[[_,s.gsm]])]),t("td",ut,[m(t("input",{"onUpdate:modelValue":d=>s.print_color=d,type:"text",class:"w-20 border-gray-300 rounded-md text-sm p-1"},null,8,mt),[[_,s.print_color]])]),t("td",pt,[m(t("input",{"onUpdate:modelValue":d=>s.quantity=d,type:"number",min:"1",class:"w-20 border-gray-300 rounded-md text-sm p-1 text-right",required:"",onInput:d=>w(y)},null,40,ct),[[_,s.quantity]])]),t("td",_t,[m(t("input",{"onUpdate:modelValue":d=>s.unit_price=d,type:"number",step:"0.01",min:"0",class:"w-24 border-gray-300 rounded-md text-sm p-1 text-right",readonly:n(k),onInput:d=>w(y),required:""},null,40,xt),[[_,s.unit_price]])]),t("td",gt,p(s.total),1),t("td",yt,[n(o).items.length>1?(u(),l("button",{key:0,type:"button",onClick:d=>j(y),class:"text-red-500 hover:text-red-700"},[...e[9]||(e[9]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ft)):b("",!0)])]))),128))])]),t("button",{type:"button",onClick:S,class:"mt-2 text-indigo-600 hover:text-indigo-900 text-sm font-medium flex items-center"}," + Add Another Item ")]),t("div",ht,[t("div",null,[c(v,{for:"notes",value:"Notes"}),m(t("textarea",{id:"notes","onUpdate:modelValue":e[3]||(e[3]=s=>n(o).notes=s),rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm"},null,512),[[_,n(o).notes]])]),t("div",bt,[t("div",vt,[e[11]||(e[11]=t("span",{class:"font-medium"},"Subtotal:",-1)),t("span",null,p(n(o).subtotal),1)]),t("div",wt,[e[12]||(e[12]=t("span",{class:"text-sm"},"Other Charges:",-1)),m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n(o).other_charges=s),type:"number",step:"0.01",class:"w-24 border-gray-300 rounded-md text-sm p-1 text-right"},null,512),[[_,n(o).other_charges]])]),t("div",qt,[e[13]||(e[13]=t("span",{class:"text-sm"},"Discount:",-1)),m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>n(o).discount=s),type:"number",step:"0.01",class:"w-24 border-gray-300 rounded-md text-sm p-1 text-right"},null,512),[[_,n(o).discount]])]),t("div",kt,[e[14]||(e[14]=t("span",null,"Grand Total:",-1)),t("span",null,p(n(o).grand_total),1)]),t("div",Vt,[e[15]||(e[15]=t("span",{class:"text-sm font-medium text-green-700"},"Advance Payment:",-1)),m(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>n(o).advance_amount=s),type:"number",step:"0.01",class:"w-24 border-green-300 rounded-md text-sm p-1 text-right focus:ring-green-500"},null,512),[[_,n(o).advance_amount]])])])]),t("div",Ut,[c(n($),{href:a.route("quotations.index"),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md mr-2 hover:bg-gray-300"},{default:f(()=>[...e[16]||(e[16]=[C("Cancel",-1)])]),_:1},8,["href"]),c(D,{class:M({"opacity-25":n(o).processing}),disabled:n(o).processing},{default:f(()=>[...e[17]||(e[17]=[C(" Update Quotation ",-1)])]),_:1},8,["class","disabled"])])],32)])])])])]}),_:1})],64))}};export{Tt as default};
