import{u as E,B as F,c as m,b as f,d as n,h as A,w as h,e as t,z as L,j as V,g as i,f as _,F as w,l as U,t as x,A as j,i as v,k as p,s as N,D as $,r as z}from"./app-BGripyAl.js";import{_ as D}from"./AuthenticatedLayout-u-dhrov9.js";import{S}from"./sweetalert2.esm.all-BoFtKDfH.js";const I={class:"py-12"},B={class:"w-full mx-auto sm:px-6 lg:px-8"},M={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},q={class:"p-6 text-gray-900 dark:text-gray-100"},O={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},R={class:"md:col-span-2"},W=["value"],G=["value"],Q={key:0,class:"text-center py-8"},H={key:1,class:"overflow-x-auto mb-8"},J={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 border"},K={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200"},X={class:"px-2 py-2"},Y=["onUpdate:modelValue"],Z={class:"px-2 py-2 text-xs"},tt={class:"px-2 py-2 text-xs text-gray-500"},et={class:"px-2 py-2 text-xs text-gray-500"},ot={class:"px-2 py-2"},st=["onUpdate:modelValue","onInput"],at={class:"px-2 py-2"},nt=["onUpdate:modelValue","onInput"],dt={class:"px-2 py-2"},lt=["onUpdate:modelValue","onInput"],rt={class:"px-2 py-2"},it=["onUpdate:modelValue","onInput"],pt={class:"px-2 py-2"},ut=["onUpdate:modelValue","onInput"],ct={class:"px-2 py-2"},xt=["onUpdate:modelValue","onInput"],gt={class:"px-2 py-2"},mt=["onUpdate:modelValue","onInput"],_t={class:"px-2 py-2 text-right text-xs font-bold bg-gray-50"},yt={class:"px-2 py-2 text-right text-xs font-bold bg-gray-50"},bt={key:2,class:"flex flex-col md:flex-row justify-end space-y-4 md:space-y-0 md:space-x-8"},ft={class:"w-full md:w-1/3 space-y-3"},ht={class:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-lg w-full md:w-1/2 lg:w-1/3"},wt={class:"space-y-2"},vt={class:"flex justify-between items-center"},kt={class:"font-bold"},Ft={class:"flex justify-between items-center"},Vt={class:"flex justify-between items-center"},Ut={class:"flex justify-between items-center border-b pb-2"},jt={class:"flex justify-between items-center pt-2"},St={class:"text-lg font-bold"},Ct={class:"flex justify-between items-center text-green-700"},Pt={class:"flex justify-between items-center font-semibold border-t pt-2 mt-2"},Tt={class:"flex justify-between items-center bg-blue-50 p-2 rounded"},Et={class:"flex justify-between items-center pt-2"},At={class:"text-xl font-bold text-red-600"},Lt={class:"mt-8 flex justify-end space-x-3"},Nt=["disabled"],It={__name:"Create",props:{productions:Array},setup(C){const s=E({production_id:"",customer_id:"",customer_name:"",type:"wholesale",sale_date:new Date().toISOString().slice(0,10),items:[],subtotal:0,discount:0,tax:0,other_costs:0,grand_total:0,advance_adjusted:0,paid_amount:0,due_amount:0,note:""}),y=z(!1),k=async()=>{var u,e,o;if(s.production_id){y.value=!0;try{const a=(await $.get(route("api.productions.show",s.production_id))).data;s.customer_id=(u=a.quotation)==null?void 0:u.customer_id,s.customer_name=(o=(e=a.quotation)==null?void 0:e.customer)==null?void 0:o.name,s.advance_adjusted=parseFloat(a.advance_amount)||0,s.items=a.items.map(l=>{const d=l.quotation_item,c=d==null?void 0:d.item,T=s.type==="local"&&parseFloat(d==null?void 0:d.unit_price)||0;return{production_item_id:l.id,item_name:l.product_name,size:(d==null?void 0:d.size)||l.size||"",gsm:(d==null?void 0:d.gsm)||(c==null?void 0:c.gsm)||"",color:(d==null?void 0:d.color)||(c==null?void 0:c.fabric_color)||"",envelope_weight:parseFloat(l.envelope_weight)||0,envelope_price:parseFloat(l.envelope_price)||0,loop_weight:parseFloat(l.loop_weight)||0,loop_price:parseFloat(l.loop_price)||0,print_cost:parseFloat(l.print_cost)||0,sewing_cost:parseFloat(l.sewing_cost)||0,quantity:parseFloat(l.quantity)||0,price_per_piece:T,total_price:0}}),s.items.forEach((l,d)=>g(d))}catch(r){console.error("Error fetching production:",r),S.fire("Error","Failed to load production details.","error")}finally{y.value=!1}}},g=u=>{const e=s.items[u],o=parseFloat(e.quantity)||0;if(o<=0){e.price_per_piece=0,e.total_price=0,b();return}if(s.type==="local")e.total_price=(parseFloat(e.price_per_piece)*o).toFixed(2);else{const r=(parseFloat(e.envelope_weight)||0)*(parseFloat(e.envelope_price)||0),a=(parseFloat(e.loop_weight)||0)*(parseFloat(e.loop_price)||0),l=(parseFloat(e.print_cost)||0)*o,d=(parseFloat(e.sewing_cost)||0)*o,c=r+a+l+d;e.price_per_piece=(c/o).toFixed(2),e.total_price=c.toFixed(2)}b()},b=()=>{let u=0;s.items.forEach(c=>{u+=parseFloat(c.total_price)||0}),s.subtotal=u.toFixed(2);const e=parseFloat(s.discount)||0,o=parseFloat(s.tax)||0,r=parseFloat(s.other_costs)||0,a=u-e+o+r;s.grand_total=a.toFixed(2);const l=parseFloat(s.advance_adjusted)||0,d=parseFloat(s.paid_amount)||0;s.due_amount=(a-l-d).toFixed(2)};F(()=>[s.discount,s.tax,s.other_costs,s.advance_adjusted,s.paid_amount],()=>{b()}),F(()=>s.type,()=>{s.production_id&&k()});const P=()=>{s.post(route("sales.store"),{onError:u=>{console.error(u),S.fire({icon:"error",title:"Validation Error",text:"Please check the form for errors.",footer:Object.values(u).join("<br>")})}})};return(u,e)=>(_(),m(w,null,[f(n(A),{title:"Create Sale"}),f(D,null,{header:h(()=>[...e[8]||(e[8]=[t("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"New Sale Invoice",-1)])]),default:h(()=>[t("div",I,[t("div",B,[t("div",M,[t("div",q,[t("form",{onSubmit:L(P,["prevent"])},[t("div",O,[t("div",R,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},[V("Select Production "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>n(s).production_id=o),onChange:k,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:""},[e[9]||(e[9]=t("option",{value:"",disabled:""},"Select Completed Production",-1)),(_(!0),m(w,null,U(C.productions,o=>{var r,a,l;return _(),m("option",{key:o.id,value:o.id},x(o.production_no)+" - "+x((a=(r=o.quotation)==null?void 0:r.customer)==null?void 0:a.name)+" (Qty: "+x((l=o.items)==null?void 0:l.reduce((d,c)=>d+parseFloat(c.quantity),0))+") ",9,W)}),128))],544),[[j,n(s).production_id]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Sale Type",-1)),i(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n(s).type=o),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...e[11]||(e[11]=[t("option",{value:"wholesale"},"Wholesale",-1),t("option",{value:"local"},"Local Sales",-1)])],512),[[j,n(s).type]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Customer",-1)),t("input",{type:"text",value:n(s).customer_name,readonly:"",class:"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 dark:bg-gray-600 dark:text-gray-300 cursor-not-allowed"},null,8,G)])]),y.value?(_(),m("div",Q,[...e[14]||(e[14]=[t("p",{class:"text-lg animate-pulse"},"Loading Production Details...",-1)])])):v("",!0),n(s).items.length>0?(_(),m("div",H,[e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Sale Items",-1)),t("table",J,[e[15]||(e[15]=t("thead",{class:"bg-indigo-600 text-white"},[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium"},"Item Name"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-16"},"Size"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-16"},"GSM"),t("th",{class:"px-2 py-2 text-left text-xs font-medium w-20"},"Color"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Env Wt"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Env Price"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Loop Wt"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Loop Price"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Print"),t("th",{class:"px-2 py-2 text-right text-xs font-medium"},"Sewing"),t("th",{class:"px-2 py-2 text-right text-xs font-medium w-16"},"Qty"),t("th",{class:"px-2 py-2 text-right text-xs font-medium bg-gray-700"},"Rate"),t("th",{class:"px-2 py-2 text-right text-xs font-medium bg-gray-700"},"Total")])],-1)),t("tbody",K,[(_(!0),m(w,null,U(n(s).items,(o,r)=>(_(),m("tr",{key:r},[t("td",X,[i(t("input",{"onUpdate:modelValue":a=>o.item_name=a,type:"text",class:"w-24 rounded-md border-gray-300 text-xs p-1",readonly:""},null,8,Y),[[p,o.item_name]])]),t("td",Z,x(o.size),1),t("td",tt,x(o.gsm),1),t("td",et,x(o.color),1),t("td",ot,[i(t("input",{"onUpdate:modelValue":a=>o.envelope_weight=a,type:"number",step:"0.001",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,st),[[p,o.envelope_weight]])]),t("td",at,[i(t("input",{"onUpdate:modelValue":a=>o.envelope_price=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,nt),[[p,o.envelope_price]])]),t("td",dt,[i(t("input",{"onUpdate:modelValue":a=>o.loop_weight=a,type:"number",step:"0.001",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,lt),[[p,o.loop_weight]])]),t("td",rt,[i(t("input",{"onUpdate:modelValue":a=>o.loop_price=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,it),[[p,o.loop_price]])]),t("td",pt,[i(t("input",{"onUpdate:modelValue":a=>o.print_cost=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,ut),[[p,o.print_cost]])]),t("td",ct,[i(t("input",{"onUpdate:modelValue":a=>o.sewing_cost=a,type:"number",step:"0.01",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right",onInput:a=>g(r)},null,40,xt),[[p,o.sewing_cost]])]),t("td",gt,[i(t("input",{"onUpdate:modelValue":a=>o.quantity=a,type:"number",step:"1",class:"w-16 rounded-md border-gray-300 text-xs p-1 text-right font-bold",onInput:a=>g(r)},null,40,mt),[[p,o.quantity]])]),t("td",_t,x(o.price_per_piece),1),t("td",yt,x(o.total_price),1)]))),128))])])])):v("",!0),n(s).items.length>0?(_(),m("div",bt,[t("div",ft,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium"},"Notes",-1)),i(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>n(s).note=o),class:"w-full rounded-md border-gray-300 shadow-sm",rows:"3"},null,512),[[p,n(s).note]])]),t("div",ht,[t("div",wt,[t("div",vt,[e[18]||(e[18]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Subtotal",-1)),t("span",kt,x(n(s).subtotal),1)]),t("div",Ft,[e[19]||(e[19]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Less: Discount",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n(s).discount=o),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[p,n(s).discount]])]),t("div",Vt,[e[20]||(e[20]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Add: Tax/VAT",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n(s).tax=o),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[p,n(s).tax]])]),t("div",Ut,[e[21]||(e[21]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Other Costs",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>n(s).other_costs=o),type:"number",class:"w-24 text-right rounded-md border-gray-300 p-1"},null,512),[[p,n(s).other_costs]])]),t("div",jt,[e[22]||(e[22]=t("span",{class:"text-lg font-bold"},"Grand Total",-1)),t("span",St,x(n(s).grand_total),1)]),t("div",Ct,[e[23]||(e[23]=t("span",null,"Less: Advance (Adjusted)",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>n(s).advance_adjusted=o),type:"number",class:"w-24 text-right rounded-md border-green-300 bg-green-50 p-1 font-bold"},null,512),[[p,n(s).advance_adjusted]])]),t("div",Pt,[e[24]||(e[24]=t("span",null,"Receivable Amount",-1)),t("span",null,x((parseFloat(n(s).grand_total)-parseFloat(n(s).advance_adjusted||0)).toFixed(2)),1)]),t("div",Tt,[e[25]||(e[25]=t("span",{class:"font-bold text-blue-800"},"Paid Now",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>n(s).paid_amount=o),type:"number",class:"w-32 text-right rounded-md border-blue-300 p-1 font-bold text-lg"},null,512),[[p,n(s).paid_amount]])]),t("div",Et,[e[26]||(e[26]=t("span",{class:"text-xl font-bold text-red-600"},"Due Amount",-1)),t("span",At,x(n(s).due_amount),1)])])])])):v("",!0),t("div",Lt,[f(n(N),{href:u.route("sales.index"),class:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"},{default:h(()=>[...e[27]||(e[27]=[V("Cancel",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded shadow-lg",disabled:n(s).processing}," Finalize Sale ",8,Nt)])],32)])])])])]),_:1})],64))}};export{It as default};
